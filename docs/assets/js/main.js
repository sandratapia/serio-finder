"use strict";const userLogin=document.querySelector(".user-js"),landing=document.querySelector(".landing-js"),adviseUser=document.querySelector(".user__advise-js"),access=document.querySelector(".access-js"),welcome=document.querySelector(".welcome-js"),inputSearch=document.querySelector(".search-js"),lupa=document.querySelector(".lupa-js"),myFavourites=document.querySelector(".favourites-js"),hiddenSection=document.querySelector(".hiddenSection-js"),arrowUp=document.querySelector(".arrowUp-js"),filmsSearch=document.querySelector(".filmSearch-js"),resetBtn=document.querySelector(".reset-js"),ulContainer=document.querySelector(".list-js"),favContainer=document.querySelector(".favContainer-js"),counterPrint=document.querySelector(".counter-js");let counter=0,tvShows=[],favouriteShows=[],user={name:"",favourites:""};function hiddenModal(e){""!==userLogin.value||""!=user.name?(landing.style.display="none",welcome.innerHTML=`Â¡Bienvenido/a ${""!==userLogin.value?userLogin.value:user.name}!`,valueUser()):adviseUser.classList.remove("hidden")}function toogleFavourites(){hiddenSection.classList.toggle("hidden"),arrowUp.classList.toggle("upDown"),filmsSearch.classList.toggle("addGrid")}function hiddenFavourites(){hiddenSection.classList.contains("hidden")||(hiddenSection.classList.toggle("hidden"),arrowUp.classList.toggle("upDown"),filmsSearch.classList.toggle("addGrid"))}function searchFilms(e){const t="http://api.tvmaze.com/search/shows?q="+inputSearch.value;e.preventDefault(),fetch(t).then(e=>e.json()).then(e=>{tvShows=e,paintTVs()})}function constructorLi(e){const t=document.createElement("li");t.setAttribute("class","main__listSeries"),favouriteShows.includes(JSON.stringify(e))&&t.classList.add("favourite__tvShow");const o=document.createElement("div");o.setAttribute("class","img__film"),t.appendChild(o);const n=document.createElement("img");n.setAttribute("class","images"),e.show.image&&e.show.image.medium?n.src=e.show.image.medium:n.src="./assets/images/img-no-disponible.jpg",n.setAttribute("title",e.show.name),o.appendChild(n);let i=document.createElement("div");i.setAttribute("class","title__film"),t.appendChild(i);let r=document.createElement("h3"),s=document.createTextNode(e.show.name);return r.appendChild(s),i.appendChild(r),t}function paintTVs(){ulContainer.innerHTML="";for(let e of tvShows){const t=constructorLi(e);ulContainer.appendChild(t),t.addEventListener("click",(function(t){t.currentTarget.classList.toggle("favourite__tvShow"),makeFavourite(e)})),resetBtn.addEventListener("click",(function(e){t.classList.remove("favourite__tvShow"),counterPrint.innerHTML="0"}))}}function makeFavourite(e){favouriteShows.includes(JSON.stringify(e))?(favouriteShows.splice(favouriteShows.indexOf(JSON.stringify(e)),1),counter-=1):(favouriteShows.push(JSON.stringify(e)),counter+=1),hiddenSection.classList.contains("hidden")&&toogleFavourites(),0===favouriteShows.length&&hiddenFavourites(),paintFavourites(),addCounter(),valueUser()}function paintFavourites(){favContainer.innerHTML="";for(let e of favouriteShows){let t=constructorLi(JSON.parse(e));removeFavourite(t,e),favContainer.appendChild(t)}}function removeFavourite(e,t){e.addEventListener("click",(function(e){favouriteShows.splice(favouriteShows.indexOf(t),1),paintFavourites(),counter-=1,addCounter(),removeFavouriteFromSearch(t),0===favouriteShows.length&&hiddenFavourites()}))}function removeFavouriteFromSearch(e){const t=ulContainer.querySelectorAll(".main__listSeries");for(let o of tvShows)JSON.parse(e).show.id==o.show.id&&t[tvShows.indexOf(o)].classList.remove("favourite__tvShow")}function resetFavourites(){counter=0,favouriteShows=[],addCounter(),valueUser(),paintFavourites(),hiddenFavourites()}function addCounter(){counterPrint.innerHTML=""+counter}function valueUser(){user.name=userLogin.value,user.favourites=favouriteShows,localStorage.setItem("user",JSON.stringify(user))}function recoverUser(){const e=localStorage.getItem("user"),t=JSON.parse(e);null!==t&&(userLogin.value=t.name,user.name=t.name,userLogin.innerHTML=t.name,user.favourites=t.favourites,favouriteShows=user.favourites,counter=favouriteShows.length,addCounter(),paintFavourites(),hiddenModal(),favouriteShows.length>0&&toogleFavourites())}recoverUser(),userLogin.addEventListener("keyup",(function(e){13===e.keyCode&&(valueUser(),hiddenModal(e))})),access.addEventListener("click",hiddenModal),myFavourites.addEventListener("click",toogleFavourites),inputSearch.addEventListener("keyup",(function(e){13===e.keyCode?searchFilms(e):""===inputSearch.value&&(ulContainer.innerHTML="")})),lupa.addEventListener("click",searchFilms),resetBtn.addEventListener("click",resetFavourites);